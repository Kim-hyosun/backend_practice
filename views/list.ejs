<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>document_list</title>
    <!-- bootstrap : cdn -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous" />
    <!-- custom style -->
    <link rel="stylesheet" href="/main.css" />
    <style></style>
  </head>

  <body class="grey-bg">
    <%- include('nav.ejs', {param: "Ïó¨Í∏∞Îäî Î¶¨Ïä§Ìä∏ÏûÖÎãàÎã§"}) %>

<!--     <%= JSON.stringify(postList) %> -->

    <div class="white-bg">
  <% for (let item of postList){ %>
      <div class="list-box">
        <a href="/detail/<%= item._id %>">
        <h4><%= item.title %> <a href="/edit/<%= item._id %>" class="edit">‚úèÔ∏è</a>      <span class="delete" data-post="<%= item._id %>"> üóëÔ∏è</span></h4>  
        <p><%= item.content.length > 100 ? item.content.slice(0, 100) + "..." : item.content %></p>
        <form action="/like?_method=PUT" method="POST">
          <input name="ID" value="<%= item._id %>" />
          <button type="submit">‚ù§Ô∏è</button><span> <%= item.like === 0 ? "" : item.like %> </span>
        </form>

        </a>
        </div>
    
  <% } %>

  <!-- axios : cdn (ssrÏóêÏÑúÎäî requireÏïàÎêòÍ≥†, Î∏åÎùºÏö∞Ï†ÄÏóêÏÑúÎäî requireÎ™ªÏîÄ ) -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 

  <!-- bootstrap : cdn -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous">
  </script>

      <script>
        const postList = document.querySelectorAll('.delete')
        for(let item of postList){
          item.addEventListener('click', (e)=>{
            let mypost = e.target.dataset.post;

            /* fetch(`/delete?postId=${mypost}`, { method:'DELETE' })
            .then((r)=> r.text())
            .then((res)=>{
              if(res.status === 200){
                //ÏÑúÎ≤ÑÏùëÎãµ ÏÑ±Í≥µÏãú
                return console.log(res)
              }else{
                //ÏÑúÎ≤ÑÍ∞Ä ÏóêÎü¨ÏΩîÎìú Ï†ÑÏÜ°Ïãú Ïã§ÌñâÌï† ÏΩîÎìú
              }
            }).catch((err)=>{
               //Ïù∏ÌÑ∞ÎÑ∑Î¨∏Ï†ú Îì±ÏúºÎ°ú Ïã§Ìå®Ïãú Ïã§ÌñâÌï†ÏΩîÎìú
              console.log(err)
            }) */

            /* ÏúÑ fetchÏΩîÎìúÎ•º axiosÎ°ú Ïì∞Î©¥ Ï¢ÄÎçî Ìé∏Ìï® + Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú ÏÑ±Í≥µÏãú htmlÏßÄÏö∞Í∏∞ Ï∂îÍ∞Ä*/
          axios.delete(`/delete?postId=${mypost}`)
           .then(res => {
            console.log(res.data);
            //html ÏßÄÏö∞Í∏∞ = style.display="none";ÏúºÎ°úÎèÑ Í∞ÄÎä•
            e.target.parentElement.parentElement.remove(); 
            //Íµ≥Ïù¥ htmlÏùÑ ÏßÄÏõåÏ£ºÎäî Ïù¥Ïú† ? ÎπÑÎèôÍ∏∞Î°ú deleteÎ©îÏÑúÎìú Ïã§ÌñâÌïòÍ≥†, ÌôîÎ©¥ ÏÉàÎ°úÍ≥†Ïπ®ÌïòÎ©¥ ÏùòÎØ∏ÏóÜÏñ¥ÏÑú... 
          })
           .catch(err => console.error(err));
           
          })
        }
       
      </script>
  </body>
</html>
