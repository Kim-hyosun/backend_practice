<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>document_postlist</title>
    <!-- bootstrap : cdn -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous" />
    <!-- custom style -->
    <link rel="stylesheet" href="/main.css" />
    <style></style>
  </head>

  <body class="grey-bg">
    <%- include('nav.ejs', {param: "ì—¬ê¸°ëŠ” ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤"}) %>

<!--     <%= JSON.stringify(postList) %> -->
<div class="search_bar">
<input class="search">
<button class="search-send">ğŸ”</button>
</div>
<script>
  document.querySelector('.search-send').addEventListener('click', function(){
    let inputData = document.querySelector('.search').value;
    location.href = `/search?val=${inputData}`; //getìš”ì²­ - í•´ë‹¹ URLë¡œ ì´ë™
  })
</script>


    <div class="white-bg">
  <% for (let item of postList){ %>
      <div class="list-box">
        <a href="/detail/<%= item._id %>">
        <h4><%= item.title %> 
          
          <% if (JSON.stringify(user._id) === JSON.stringify(item.user)) { %>
          <a href="/edit/<%= item._id %>" class="edit">âœï¸</a>      <span class="delete" data-post="<%= item._id %>" data-pagenum="<%= pagenum %>" data-postWriter="<%= item.user %>"> ğŸ—‘ï¸</span>
          <% } %>
        </h4>  

        <p><%= item.content.length > 100 ? item.content.slice(0, 100) + "..." : item.content %></p>

        <%- item.img ? `<img src="${item.img}" alt="Image_${item.title}" class="list_img" />` : '' %>
       
        <form action="/like?_method=PUT" method="POST">
          <input name="ID" value="<%= item._id %>" />
          <input name="pagenum" value="<%= pagenum %>" />
          <button type="submit">â¤ï¸</button><span> <%= item.like === 0 ? "" : item.like %> </span>
        </form>

        </a>
        </div>
    
  <% } %>

  <!-- í˜ì´ì§€ë„¤ì´ì…˜, 5ê°œ ë‹¨ìœ„ë¡œ í™”ë©´ì— í¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.  -->
   <div class="pagenation">
  <% for (let i = 1 ; i <= allPost.length ; i += 5){ %>
    <a href="/list/<%= Math.floor((i - 1) / 5) + 1  %>"><%= Math.floor((i - 1) / 5) + 1 %></a>
  <% } %>
</div>
  <!-- axios : cdn (ssrì—ì„œëŠ” requireì•ˆë˜ê³ , ë¸Œë¼ìš°ì €ì—ì„œëŠ” requireëª»ì”€ ) -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script> 

  <!-- bootstrap : cdn -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous">
  </script>

      <script>
        const postList = document.querySelectorAll('.delete')
        for(let item of postList){
          item.addEventListener('click', (e)=>{
            let mypost = e.target.dataset.post;
            let pagenum = e.target.dataset.pagenum;
            let postWriter = e.target.dataset.postWriter;

            /* fetch(`/delete?postId=${mypost}`, { method:'DELETE' })
            .then((r)=> r.text())
            .then((res)=>{
              if(res.status === 200){
                //ì„œë²„ì‘ë‹µ ì„±ê³µì‹œ
                return console.log(res)
              }else{
                //ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œ ì „ì†¡ì‹œ ì‹¤í–‰í•  ì½”ë“œ
              }
            }).catch((err)=>{
               //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í• ì½”ë“œ
              console.log(err)
            }) */

            /* ìœ„ fetchì½”ë“œë¥¼ axiosë¡œ ì“°ë©´ ì¢€ë” í¸í•¨ + ë°ì´í„° ì‚­ì œ ì„±ê³µì‹œ htmlì§€ìš°ê¸° ì¶”ê°€*/
          axios.delete(`/delete?postId=${mypost}`)
           .then(res => {
              e.target.parentElement.parentElement.remove();
              location.href=`/list/${pagenum}`;
            
            //êµ³ì´ htmlì„ ì§€ì›Œì£¼ëŠ” ì´ìœ  ? ë¹„ë™ê¸°ë¡œ deleteë©”ì„œë“œ ì‹¤í–‰í•˜ê³ , í™”ë©´ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ì˜ë¯¸ì—†ì–´ì„œ... 
          })
           .catch(err => console.error(err));
          })
        }
       
      </script>
  </body>
</html>
